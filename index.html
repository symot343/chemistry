<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>高２化学期末</title>
    <link rel="stylesheet" href="chemistry.css">
</head>

<body>
<h1>物質 色当てクイズ</h1>
<div class="explanation">
    <details open>
        <summary>説明</summary>
        <p>Startで開始、化学物質名が表示される。
            <br>選択肢から色を当てる。
            <br>10問正解するスピードを競う。
        </p>
    </details>
</div>

<div class="start_button">
    <input type="button" id="start_button" value="Start"
    style="width:64px;height:32px;bottom:5px;position:relative">
    <p id="problem_num">第0問</p>
    <p id="status">開始前</p>
</div>

<div class="problem_space"
style="padding:10px;margin-bottom:10px;border:1px solid #333333">
    <p id="problem">問題</p>
    <hr>
    <p id="problem_sub">もんだい</p>
</div>

<div class="next_button">
    <input type="button" id="next_button" value="Next"
    style="width:64px;height:32px;bottom:5px;position:relative">
</div>

<div class="choice_buttons">
    <p>【選択肢】</p>
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice1" class="choice" value="赤紫色">
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice2" class="choice" value="黒色">
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice3" class="choice" value="黄緑色">
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice4" class="choice" value="無色">
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice5" class="choice" value="青白色">
    <input type="button" onclick="choiceButtonClick(this.id)" id="choice6" class="choice" value="赤色">
</div>

<script>
    //id取得群
    let start_button = document.getElementById("start_button");
    let problem_num = document.getElementById("problem_num");
    let status = document.getElementById("status");
    let next_button = document.getElementById("next_button");
    let problem = document.getElementById("problem");
    let problem_sub = document.getElementById("problem_sub");
    //値定義群
    let start_status = false;
    let next_status = false;
    let gameover_status = false;
    let answer = "無色";
    //問題集jsonしたい
    let questions = [
        { id: 0, name: "黒鉛", formula: "C", color: "黒色" },
        { id: 1, name: "ダイヤモンド", formula: "C", color: "無色" },
        { id: 2, name: "一酸化炭素", formula: "CO", color: "無色" },
        { id: 3, name: "二酸化炭素", formula: "CO2", color: "無色" },
        { id: 4, name: "リチウムの炎色反応", formula: "K flame", color: "赤色" },
        { id: 5, name: "ナトリウムの炎色反応", formula: "Na flame", color: "黄色" },
        { id: 6, name: "カリウムの炎色反応", formula: "K flame", color: "赤紫色" },
        { id: 7, name: "銅の炎色反応", formula: "Cu flame", color: "青緑色" },
        { id: 8, name: "バリウムの炎色反応", formula: "Ba flame", color: "黄緑色" },
        { id: 9, name: "カルシウムの炎色反応", formula: "Ca flame", color: "橙赤色" },
        { id: 10, name: "ストロンチウムの炎色反応", formula: "Sr flame", color: "紅色" },
    ]
    //ここで全ての色の名前をリストアップ
    let color_code = {
        "黒色":["#000000",0],
        "無色":["#ffffff",1],
        "赤色":["#ff0000",1],
        "黄色":["#ffff00",1],
        "赤紫色":["#c54ea0",0],
        "青緑色":["#00a497",0],
        "黄緑色":["#b8d200",1],
        "橙赤色":["#ea5506",0],
        "紅色":["#d7003a",0]
    };
    let color_list = [];
    for (let key in color_code){
        color_list.push(key);
    }
    function startButtonClick(){
        if (start_status){
            alert("すでに始まっています")
        }else{
            start_status = true;
            status.textContent = "回答中";
            //出題開始
            giveQuestion();
        }
    }
    start_button.onclick = startButtonClick;
    function nextButtonClick(){
        if (next_status){
            next_status = false;
            //出題
            giveQuestion();
        }else{
            alert("まずは今の問題");
        }
    }
    next_button.onclick = nextButtonClick;
    //色塗り
    function colorButton(id,c){
        let b = document.getElementById(id);
        b.style.background = color_code[c][0];
        if (color_code[c][1]){
            b.style.color = "black";
        }else{
            b.style.color = "white";
        }
        b.value = c;
        b.style.border = "1px solid black"
    }
    function giveQuestion(){
        let index = Math.floor(Math.random()*questions.length);
        let question = questions[index];
        console.log(question)
        problem.textContent = question.name;
        problem_sub.textContent = question.formula;
        //文字サイズを指定していこう
        if (question.name.length>=12){
            problem.style.fontSize = "20px";
        }else if (question.name.length>=9){
            problem.style.fontSize = "30px";
        }else if (question.name.length>=7){
            problem.style.fontSize = "40px";
        }else if (question.name.length>=6){
            problem.style.fontSize = "50px";
        }else{
            problem.style.fontSize = "60px";
        }
        //答えの選択肢をセット
        answer = question.color;
        //５個選んでから答えと差し替えればいいじゃん
        let color_list_copy = structuredClone(color_list);
        let choice_list = []
        for (let i=0;i<6;i++){
            let num = Math.floor(Math.random()*color_list_copy.length);
            choice_list.push(color_list_copy[num]);
            color_list_copy.splice(num,1);
        }
        console.log(answer)
        console.log(choice_list)
        if (!choice_list.includes(answer)){
            choice_list[Math.floor(Math.random() * 6)] = answer;
        }
        console.log(choice_list);
        //選択肢準備完了
        //色塗り
        for (let i=1;i<=6;i++){
            colorButton("choice"+String(i),choice_list[i-1]);
        }
    }
    function choiceButtonClick(id){
        if (gameover_status == true) {
            alert("リロードしてください")
            return;
        }
        if (start_status == false) {
            alert("Startを押してください")
            return;
        }
        if (next_status == true) {
            alert("正解済みです")
            return;
        }
        let the_choice = document.getElementById(id);
        let guess = the_choice.value;
        the_choice.style.background = "white";
        the_choice.style.border = "2px solid " + color_code[guess][0];
        the_choice.style.color = "black";
        if (guess == answer) {
            alert("正解です")
            next_status = true;
        }
        else {
            let send = "不正解、答えは" + answer + "でした"
            alert(send)
            gameover_status = true;
        }
    }
</script>

</body>
</html>